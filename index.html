<html>
<head>
    <title>Visual Composer Shortcode Generator</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"/>
    <script src="//cdn.jsdelivr.net/jquery/1.11.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/handlebarsjs/1.3.0/handlebars.min.js"></script>
    <style>
        .g{
            display: none;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h1>VC Shortcode Genarator</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div id="shortcode">
                <form action="">
                    <div class="form-group">
                        <label for="scname">Shortcode Name</label>
                        <input type="text" class="form-control" id="scname" placeholder="Enter Shortcode Name">
                    </div>
                    <div class="form-group">
                        <label for="scfuncname">Shortcode Function Name</label>
                        <input type="text" class="form-control" id="scfuncname" placeholder="Enter Shortcode Function Name">
                    </div>
                    <div class="form-group">
                        <label for="sccategory">Shortcode Category</label>
                        <input type="text" class="form-control" id="sccategory" placeholder="Enter Shortcode Category">
                    </div>
                </form>
            </div>
            <div id="container">

            </div>
            <button id="generate" type="button" class="btn btn-success">Generate Code</button>
            <button id="import" type="button" class="btn btn-success">Import From JSON</button>
            <form action="">
                <br/><br/>
                <h3 class="g">VC Mapping</h3>
                <textarea id="code" style="display: none;" class="g form-control" rows="10"></textarea>
                <br/><br/>
                <h3 class="g">WP Shortcode Helper</h3>
                <textarea id="wpcode" style="display: none;" class="g form-control" rows="10"></textarea>
                <h3 class="j g importlabel">Form Elements JSON (Paste to import)</h3>
                <textarea id="importarea" style="display: none;" class="j form-control" rows="10"></textarea>
                <br/>
                <button id="importjson" type="button" class=" j g btn btn-danger">Import</button>
                <button id="hidejson" type="button" class=" j g btn btn-danger">Hide</button>


            </form>
            <div id="placeholder" style="display: none;">
                <form class="form-inline last" role="form" data-index="1">
                    <h3>Item 1</h3>
                    <div class="form-group">
                        <select class="form-control type">
                            <option value="0">Type</option>
                            <option value="textfield">TextField</option>
                            <option value="textarea_html">WYSIWYG</option>
                            <option value="colorpicker">ColorPicker</option>
                            <option value="attach_image">Single Image</option>
                            <option value="attach_images">Gallery</option>
                            <option value="dropdown">Dropdown</option>
                        </select>
                        <input type="text" class="form-control heading" placeholder="Heading">
                        <input type="text" class="form-control param" placeholder="Param Name">
                        <input type="text" class="form-control value" placeholder="Value">
                        <input type="text" class="form-control group" placeholder="Group Name">
                        <input type="checkbox" value="1" class="admin_label"> Admin Label

                    </div>
                    <button type="button" class="btn btn-danger addnew">Add New</button>
                </form>
            </div>

        </div>
    </div>
</div>
<script id="item" type="text/x-handlebars-template">
array(
    "type" => "{{t}}",
    "heading" => __("{{heading}}"),
    "param_name" => "{{p}}",
    "value" => "{{v}}",{{#if group}}
    "group" => "{{group}}",{{/if}} {{#if admin}}
    "admin_label"=>true,{{/if}}
),
</script>
<script id="shortcodetemplate" type="text/x-handlebars-template">
    vc_map(array(
        "name" => __("{{sch}}"),
        "base" => "{{scf}}",
        "class" => "",
        "category" => __('{{scc}}'),
        "params" => array(
            {{{scp}}}
        )
    ));
</script>
<script type="application/javascript">
    var index = 0;
    $(document).ready(function(){
        $("#container").on("click",".addnew", function(){
            addElement();
        });

        $("#generate").on("click",function(){
            var json = [];
            $("#code").html("");
            $("#importarea").html("");
            $("#wpcode").html("");
            $("#wpcode").append("function "+$("#scfuncname").val()+"($atts, $content=null)\n{\n\textract(shortcode_atts(array(\n");
            var scp = "";
            var itemTemplate = Handlebars.compile($("#item").html());
            var scTemplate = Handlebars.compile($("#shortcodetemplate").html());
            $("#container").find("form").each(function(){
                var id = $(this).attr("id");
                var heading = $(this).find(".heading").val();
                var type = $(this).find(".type").val();
                var param = $(this).find(".param").val();
                var value = $(this).find(".value").val();
                $("#wpcode").append("\t\t'"+param+"' => '"+value+"',\n");
                var group = $(this).find(".group").val();
                var admin = $(this).find(".admin_label").is(":checked");
                var params ={heading:heading, t:type, p:param,v:value,g:group,admin:admin,form:id};
                json.push(params);
                var itemCode = itemTemplate(params);
                scp += itemCode;

            });

            var scparams = {sch: $("#scname").val(),scf:$("#scfuncname").val(),scc:$("#sccategory").val(),scp:scp};
            var shortcode = scTemplate(scparams);


            $("#code").val(shortcode);

            $("#wpcode").append("\t),$atts));\n\treturn $content;\n}")
            $("#wpcode").append("\nadd_shortcode('"+$("#scfuncname").val()+"', '"+$("#scfuncname").val()+"');");
            $(".g").show();
            $("#code").show();
            $("#wpcode").show();
//            alert(json);
            //add the schortcode defs
            delete(scparams['scp']);
            json.push(scparams);
            $("#importarea").val(JSON.stringify(json));
            $("#importarea").show();
        });

        $("#import").on("click",function(){
            $(".importlabel").show();
            $("#importarea").show();
            $("#importjson").show();
            $("#hidejson").show();
        });

        $("#importjson").on("click",function(){
            var jsonstring = $("#importarea").val();
            var json = $.parseJSON(jsonstring);
            var scparams = json.pop();

            $("#scname").val(scparams.sch);
            $("#scfuncname").val(scparams.scf)
            $("#sccategory").val(scparams.scc);

            $("#container").html("");
            index=0;
            for(i in json){
                var param = json[i];
                addElement();
                setElementValues(param.form, param.t, param.heading, param.p, param.v, param.g, param.admin)
            }
            $(".j").hide();
        });

        function addElement(){
            index++;
            $("#container").append($("#placeholder").html());
            var lastItem = $("#container").find(".last");
            $(lastItem).find("h3").html("Item "+index);
            $(lastItem).removeClass("last");
            $(lastItem).attr("id","form_"+index);
        }

        function setElementValues(id,type,heading,param,value,group,admin){
            $("#"+id).find(".heading").val(heading);
            $("#"+id).find(".type").val(type);
            $("#"+id).find(".param").val(param);
            $("#"+id).find(".group").val(group);
            $("#"+id).find(".value").val(value);
            if(admin)
            $("#"+id).find(".admin_label").prop("checked",true);
        }

        $("#hidejson").on("click",function(){
            $(".j").hide();
        });

        addElement();
    });
</script>
</body>
</html>